<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Karya CRM</title>

    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2563eb">

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Configuration -->
    <script>
        tailwind.config = {
            theme: { extend: { colors: { brand: { 500: '#3b82f6', 600: '#2563eb', 900: '#1e3a8a' } } } }
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>

    <!-- Dynamic Manifest -->
    <script>
        const manifest = { name: "Karya CRM", short_name: "Karya", start_url: ".", display: "standalone", background_color: "#ffffff", theme_color: "#2563eb", icons: [{ src: "https://img.icons8.com/fluency/192/group-task.png", sizes: "192x192", type: "image/png" }, { src: "https://img.icons8.com/fluency/512/group-task.png", sizes: "512x512", type: "image/png" }] };
        document.head.appendChild(Object.assign(document.createElement('link'), { rel: 'manifest', href: URL.createObjectURL(new Blob([JSON.stringify(manifest)], { type: 'application/json' })) }));
    </script>
</head>

<body class="bg-slate-50 text-slate-900 font-sans pb-safe selection:bg-blue-100 selection:text-blue-700">

    <div id="app-container" class="min-h-screen relative overflow-x-hidden">

        <!-- SIDEBAR (Desktop) -->
        <div id="nav-sidebar"
            class="hidden fixed inset-y-0 left-0 w-64 bg-slate-900 text-white z-50 flex-col transition-transform shadow-2xl">
            <!-- Content injected by script.js -->
        </div>

        <!-- HEADER (Mobile) -->
        <div id="nav-mobile-header"
            class="hidden md:hidden fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-md border-b border-slate-200 h-16 z-40 flex items-center justify-between px-4 shadow-sm">
            <!-- Content injected by script.js -->
        </div>

        <!-- MAIN VIEW AREA -->
        <main id="main-content" class="pt-16 md:pt-0 min-h-screen transition-all duration-300">

            <!-- 1. LANDING PAGE -->
            <div id="view-landing" class="view-section hidden">
                <div class="flex flex-col min-h-screen bg-white">
                    <header
                        class="flex items-center justify-between px-6 py-4 border-b border-slate-100 sticky top-0 bg-white/90 backdrop-blur-sm z-20">
                        <div class="flex items-center gap-2">
                            <div class="px-6 py-6"> <img src="assets/logo.png" class="h-8 mx-auto" /> </div>
                        </div>
                        <button onclick="App.router.navigate('login')"
                            class="px-6 py-2.5 text-sm font-bold text-white bg-slate-900 rounded-full hover:bg-slate-800 hover:shadow-lg transition-all active:scale-95">Login</button>
                    </header>
                    <main
                        class="flex-1 flex flex-col items-center justify-center text-center px-4 py-12 relative overflow-hidden">
                        <div
                            class="absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[800px] bg-blue-50 rounded-full blur-3xl opacity-50 -z-10">
                        </div>
                        <div
                            class="inline-flex items-center gap-2 px-4 py-1.5 mb-8 text-xs font-bold uppercase tracking-wider text-brand-700 bg-brand-50 rounded-full border border-brand-100 animate-in fade-in slide-in-from-bottom-4 duration-700">
                            <span class="w-2 h-2 bg-brand-500 rounded-full animate-pulse"></span>
                            <span>University Outreach CRM</span>
                        </div>
                        <h1
                            class="text-4xl md:text-7xl font-extrabold text-slate-900 tracking-tight mb-6 max-w-4xl leading-tight animate-in fade-in slide-in-from-bottom-8 duration-1000">
                            Manage your <span
                                class="text-transparent bg-clip-text bg-gradient-to-r from-brand-600 to-indigo-600">Field
                                Force</span> with precision.
                        </h1>
                        <p
                            class="text-lg md:text-xl text-slate-500 max-w-2xl mb-10 leading-relaxed animate-in fade-in slide-in-from-bottom-10 duration-1000 delay-100">
                            Capture leads, track routes, and manage admissions seamlessly. <br>Offline-first &
                            Mobile-ready.
                        </p>
                        <button onclick="App.router.navigate('login')"
                            class="w-full sm:w-auto px-10 py-4 text-base font-bold text-white bg-brand-600 rounded-2xl hover:bg-brand-700 transition-all shadow-xl shadow-brand-500/30 hover:-translate-y-1 animate-in fade-in slide-in-from-bottom-12 duration-1000 delay-200">Get
                            Started</button>
                    </main>
                </div>
            </div>

            <!-- 2. LOGIN PAGE -->
            <div id="view-login" class="view-section hidden">
                <div class="min-h-screen flex items-center justify-center bg-slate-50 px-4 relative overflow-hidden">
                    <div
                        class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-blue-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob">
                    </div>
                    <div
                        class="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000">
                    </div>

                    <div id="login-card"
                        class="bg-white w-full max-w-sm rounded-3xl shadow-2xl shadow-slate-200/50 border border-slate-100 p-10 animate-float-up relative z-10">
                        <div class="text-center mb-8">

                            <div class="px-6 py-6"> <img src="assets/logo.png" class="h-8 mx-auto" /> </div>
                            <h2 class="text-2xl font-bold text-slate-900">Welcome Back</h2>
                            <p class="text-sm text-slate-500 mt-2">Enter credentials to access workspace</p>
                        </div>
                        <form id="login-form" onsubmit="handleLoginFormSubmit(event)" class="space-y-6">
                            <div>
                                <label
                                    class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">Email</label>
                                <div class="relative">
                                    <div
                                        class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400">
                                        <i data-lucide="mail" class="h-5 w-5"></i>
                                    </div>
                                    <input type="email" name="email" required
                                        class="w-full pl-11 pr-4 py-3.5 rounded-xl bg-slate-50 border border-slate-200 focus:bg-white focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all text-sm font-medium"
                                        placeholder="you@karya.com">
                                </div>
                            </div>
                            <div>
                                <label
                                    class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">Password</label>
                                <div class="relative">
                                    <div
                                        class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400">
                                        <i data-lucide="lock" class="h-5 w-5"></i>
                                    </div>
                                    <input type="password" name="password" required
                                        class="w-full pl-11 pr-4 py-3.5 rounded-xl bg-slate-50 border border-slate-200 focus:bg-white focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all text-sm font-medium"
                                        placeholder="••••••••">
                                </div>
                            </div>
                            <button type="submit" id="btn-login"
                                class="w-full py-4 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl shadow-lg shadow-brand-500/30 transition-all flex items-center justify-center gap-2 transform active:scale-[0.98]">
                                Sign In <i data-lucide="arrow-right" class="w-5 h-5"></i>
                            </button>
                            <div id="login-error"
                                class="hidden p-4 bg-red-50 text-red-600 text-xs rounded-xl text-center font-bold border border-red-100 animate-pulse flex items-center justify-center gap-2">
                                <i data-lucide="alert-circle" class="w-4 h-4"></i><span>Invalid Credentials</span>
                            </div>
                        </form>
                        <div class="mt-8 text-center">
                            <button onclick="App.router.navigate('landing')"
                                class="text-xs text-slate-400 hover:text-brand-600 font-medium transition-colors flex items-center justify-center mx-auto gap-1 group">
                                <i data-lucide="arrow-left"
                                    class="w-3 h-3 transition-transform group-hover:-translate-x-1"></i> Back to Home
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. DASHBOARD PAGE -->
            <div id="view-dashboard" class="view-section hidden p-4 md:p-10">
                <div id="dash-container" class="max-w-6xl mx-auto pb-24">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-slate-900 tracking-tight">Dashboard</h2>
                        <p class="text-slate-500 mt-1">Real-time performance overview</p>
                    </div>

                    <div id="dash-empty-state"
                        class="hidden flex flex-col items-center justify-center py-24 bg-white rounded-[2rem] border border-slate-100 shadow-sm text-center px-6">
                        <div
                            class="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mb-6 text-blue-500">
                            <i data-lucide="bar-chart-2" class="w-12 h-12"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-slate-800 mb-3">No Data Available</h3>
                        <p class="text-slate-500 max-w-sm mx-auto mb-8 leading-relaxed">Start adding leads to populate
                            your analytics dashboard with insights.</p>
                        <button onclick="App.router.navigate('leads')"
                            class="px-8 py-4 bg-brand-600 text-white rounded-xl font-bold shadow-xl shadow-brand-500/20 hover:bg-brand-700 transition transform active:scale-95 flex items-center gap-2"><i
                                data-lucide="plus" class="w-5 h-5"></i> Add First Lead</button>
                    </div>

                    <div id="dash-main-content">
                        <!-- KPI Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div
                                class="bg-white p-8 rounded-3xl shadow-[0_2px_20px_-4px_rgba(0,0,0,0.05)] border border-slate-100 relative overflow-hidden group hover:-translate-y-1 transition-transform duration-300">
                                <div class="skel-loader skeleton h-full w-full absolute inset-0 z-10"></div>
                                <div class="real-content hidden relative z-0">
                                    <div class="flex justify-between items-start mb-4">
                                        <div class="p-3 bg-blue-50 rounded-2xl text-brand-600"><i data-lucide="users"
                                                class="w-6 h-6"></i></div>
                                        <span
                                            class="text-xs font-bold bg-slate-50 text-slate-400 px-2 py-1 rounded-lg">ALL
                                            TIME</span>
                                    </div>
                                    <div class="text-slate-500 text-sm font-bold uppercase tracking-wider">Total Leads
                                    </div>
                                    <div id="stat-total"
                                        class="text-5xl font-extrabold text-slate-900 mt-2 tracking-tight">0</div>
                                </div>
                            </div>
                            <div
                                class="bg-white p-8 rounded-3xl shadow-[0_2px_20px_-4px_rgba(0,0,0,0.05)] border border-slate-100 relative overflow-hidden group hover:-translate-y-1 transition-transform duration-300">
                                <div class="skel-loader skeleton h-full w-full absolute inset-0 z-10"></div>
                                <div class="real-content hidden relative z-0">
                                    <div class="flex justify-between items-start mb-4">
                                        <div class="p-3 bg-indigo-50 rounded-2xl text-indigo-600"><i data-lucide="map"
                                                class="w-6 h-6"></i></div>
                                    </div>
                                    <div class="text-slate-500 text-sm font-bold uppercase tracking-wider">Active Routes
                                    </div>
                                    <div id="stat-routes"
                                        class="text-5xl font-extrabold text-slate-900 mt-2 tracking-tight">0</div>
                                </div>
                            </div>
                            <div
                                class="bg-white p-8 rounded-3xl shadow-[0_2px_20px_-4px_rgba(0,0,0,0.05)] border border-slate-100 relative overflow-hidden group hover:-translate-y-1 transition-transform duration-300">
                                <div class="skel-loader skeleton h-full w-full absolute inset-0 z-10"></div>
                                <div class="real-content hidden relative z-0">
                                    <div class="flex justify-between items-start mb-4">
                                        <div class="p-3 bg-emerald-50 rounded-2xl text-emerald-600"><i
                                                data-lucide="layers" class="w-6 h-6"></i></div>
                                    </div>
                                    <div class="text-slate-500 text-sm font-bold uppercase tracking-wider">Pipeline
                                        Stages</div>
                                    <div id="stat-status"
                                        class="text-5xl font-extrabold text-slate-900 mt-2 tracking-tight">0</div>
                                </div>
                            </div>
                        </div>

                        <div class="grid lg:grid-cols-3 gap-8">
                            <!-- Charts Column -->
                            <div class="lg:col-span-2 grid md:grid-cols-2 gap-8">
                                <div
                                    class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 h-96 relative flex flex-col">
                                    <h3 class="font-bold text-slate-800 mb-6 flex items-center gap-2"><i
                                            data-lucide="pie-chart" class="w-5 h-5 text-slate-400"></i> Conversion
                                        Status</h3>
                                    <div
                                        class="skel-loader skeleton h-full w-full absolute inset-0 top-16 z-10 rounded-2xl m-4">
                                    </div>
                                    <div class="real-content hidden flex-1 relative"><canvas id="chart-status"></canvas>
                                    </div>
                                </div>
                                <div
                                    class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 h-96 relative flex flex-col">
                                    <h3 class="font-bold text-slate-800 mb-6 flex items-center gap-2"><i
                                            data-lucide="bar-chart" class="w-5 h-5 text-slate-400"></i> Route
                                        Performance</h3>
                                    <div
                                        class="skel-loader skeleton h-full w-full absolute inset-0 top-16 z-10 rounded-2xl m-4">
                                    </div>
                                    <div class="real-content hidden flex-1 relative"><canvas id="chart-route"></canvas>
                                    </div>
                                </div>
                            </div>
                            <!-- Leaderboard Column -->
                            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 h-fit">
                                <h3 class="font-bold text-slate-800 mb-6 flex items-center gap-2 text-lg"><i
                                        data-lucide="trophy" class="w-6 h-6 text-yellow-500"></i> Top Performers</h3>
                                <div class="skel-loader skeleton h-60 w-full rounded-2xl"></div>
                                <div id="leaderboard-list"
                                    class="real-content hidden space-y-3 max-h-[500px] overflow-y-auto no-scrollbar pr-1">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. LEADS PAGE -->
            <div id="view-leads" class="view-section hidden p-4 md:p-8">
                <div class="max-w-3xl mx-auto">
                    <!-- Sticky Search & Filter Header -->
                    <div
                        class="sticky top-0 bg-slate-50/95 backdrop-blur z-20 py-4 border-b border-slate-200/50 mb-6 -mx-4 px-4 md:mx-0 md:px-0">
                        <div class="flex gap-3 mb-3">
                            <div class="relative flex-1 group">
                                <i data-lucide="search"
                                    class="absolute left-4 top-3.5 w-5 h-5 text-slate-400 group-focus-within:text-brand-600 transition-colors"></i>
                                <input id="search-input" onkeyup="handleSearch(this.value)"
                                    placeholder="Search Name, Phone, Route..."
                                    class="w-full pl-12 pr-4 py-3.5 rounded-2xl border border-slate-200 bg-white text-sm font-medium focus:outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 shadow-sm transition-all">
                            </div>
                            <button onclick="toggleFilterPanel()"
                                class="bg-white border border-slate-200 text-slate-600 px-4 rounded-2xl shadow-sm hover:bg-slate-50 transition active:scale-95"><i
                                    data-lucide="filter" class="w-5 h-5"></i></button>
                        </div>

                        <!-- Action Buttons -->
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="openStudentModal()"
                                class="bg-white border border-brand-200 text-brand-700 py-3.5 rounded-xl shadow-sm text-sm font-bold flex justify-center items-center gap-2 hover:bg-brand-50 hover:border-brand-300 active:scale-95 transition duration-200">
                                <div class="bg-brand-100 p-1.5 rounded-lg"><i data-lucide="graduation-cap"
                                        class="w-5 h-5 text-brand-600"></i></div> Add Student
                            </button>
                            <button onclick="openOtherModal()"
                                class="bg-white border border-slate-200 text-slate-700 py-3.5 rounded-xl shadow-sm text-sm font-bold flex justify-center items-center gap-2 hover:bg-slate-50 hover:border-slate-300 active:scale-95 transition duration-200">
                                <div class="bg-slate-100 p-1.5 rounded-lg"><i data-lucide="building-2"
                                        class="w-5 h-5 text-slate-600"></i></div> Add Other
                            </button>
                        </div>

                        <!-- Filter Panel (Hidden) -->
                        <div id="filter-panel"
                            class="hidden mt-4 bg-white p-5 rounded-2xl border border-slate-200 shadow-xl animate-in slide-in-from-top-4 fade-in">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-bold text-slate-700 text-xs uppercase tracking-wider">Advanced Filters
                                </h4><button onclick="clearFilters()"
                                    class="text-xs text-red-500 font-bold hover:underline">Clear All</button>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <select id="filter-status" class="input-std text-xs h-10">
                                    <option value="">All Statuses</option>
                                    <option value="New">New</option>
                                    <option value="Interested">Interested</option>
                                    <option value="Converted">Converted</option>
                                </select>
                                <select id="filter-type" class="input-std text-xs h-10">
                                    <option value="">All Types</option>
                                    <option value="Student">Student</option>
                                    <option value="Other">Institutional</option>
                                </select>
                            </div>
                            <button onclick="applyAdvancedFilters()"
                                class="w-full py-3 bg-slate-900 text-white rounded-xl text-sm font-bold hover:bg-slate-800">Apply
                                Filters</button>
                        </div>
                    </div>

                    <!-- List Container -->
                    <div id="leads-list" class="space-y-4 pb-32 min-h-[300px]"></div>

                    <!-- Pagination -->
                    <div id="pagination-controls"
                        class="flex justify-between items-center py-6 border-t border-slate-200 hidden">
                        <button id="btn-prev" onclick="changePage(-1)"
                            class="px-6 py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold hover:bg-slate-50 transition">Previous</button>
                        <span id="page-info"
                            class="text-sm text-slate-500 font-mono bg-slate-100 px-3 py-1 rounded-lg">Page 1</span>
                        <button id="btn-next" onclick="changePage(1)"
                            class="px-6 py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold hover:bg-slate-50 transition">Next</button>
                    </div>
                </div>
            </div>

            <!-- 5. ADMIN PAGE -->
            <div id="view-admin" class="view-section hidden p-4 md:p-10">
                <div class="max-w-7xl mx-auto pb-24">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
                        <div>
                            <h2 class="text-3xl font-bold text-slate-900">Admin Console</h2>
                            <p class="text-slate-500 mt-1">Organization settings & controls</p>
                        </div>
                        <button onclick="loadAdmin()"
                            class="p-3 bg-white hover:bg-slate-50 text-slate-600 rounded-xl border border-slate-200 shadow-sm transition-all active:scale-95"><i
                                data-lucide="refresh-cw" class="w-5 h-5"></i></button>
                    </div>

                    <!-- Modern Tabs -->
                    <div
                        class="flex gap-2 mb-8 overflow-x-auto no-scrollbar p-1 bg-slate-100/50 rounded-2xl border border-slate-200/50">
                        <button id="btn-tab-users" onclick="switchTab('users')"
                            class="tab-btn flex-1 px-6 py-3 text-sm font-bold rounded-xl transition-all text-slate-500 hover:bg-white/50">Users</button>
                        <button id="btn-tab-teams" onclick="switchTab('teams')"
                            class="tab-btn flex-1 px-6 py-3 text-sm font-bold rounded-xl transition-all text-slate-500 hover:bg-white/50">Teams</button>
                        <button id="btn-tab-settings" onclick="switchTab('settings')"
                            class="tab-btn flex-1 px-6 py-3 text-sm font-bold rounded-xl transition-all text-slate-500 hover:bg-white/50">Settings</button>
                        <button id="btn-tab-export" onclick="switchTab('export')"
                            class="tab-btn flex-1 px-6 py-3 text-sm font-bold rounded-xl transition-all text-slate-500 hover:bg-white/50">Export</button>
                    </div>

                    <!-- Views (Users/Teams/etc) - Structure kept same but container styles enhanced -->
                    <div id="view-users" class="tab-view">
                        <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                            <div
                                class="p-6 border-b border-slate-100 flex flex-col md:flex-row gap-4 justify-between items-center bg-slate-50/50">
                                <div class="relative w-full md:w-96"><i data-lucide="search"
                                        class="absolute left-4 top-3 w-5 h-5 text-slate-400"></i><input
                                        onkeyup="filterUsers(this.value)" placeholder="Search by name or email..."
                                        class="w-full pl-11 pr-4 py-2.5 rounded-xl border border-slate-200 bg-white focus:ring-4 focus:ring-slate-100 transition-all text-sm">
                                </div>
                                <button onclick="openUserModal()"
                                    class="w-full md:w-auto bg-slate-900 text-white px-6 py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-slate-900/20 hover:bg-slate-800 transition flex items-center justify-center gap-2"><i
                                        data-lucide="user-plus" class="w-4 h-4"></i> Add User</button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm">
                                    <thead class="bg-slate-50 text-xs uppercase font-bold text-slate-500">
                                        <tr>
                                            <th class="px-6 py-4">User</th>
                                            <th class="px-6 py-4">Role</th>
                                            <th class="px-6 py-4">Phone</th>
                                            <th class="px-6 py-4">Team</th>
                                            <th class="px-6 py-4 text-right">Edit</th>
                                        </tr>
                                    </thead>
                                    <tbody id="user-table-body" class="divide-y divide-slate-100"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- (Other Admin Views follow standard container pattern defined above) -->
                    <div id="view-teams" class="tab-view hidden">
                        <div class="flex justify-end mb-6"><button onclick="openAddTeamModal()"
                                class="bg-brand-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-brand-700 flex items-center gap-2"><i
                                    data-lucide="plus" class="w-5 h-5"></i> Create Team</button></div>
                        <div id="team-list-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        </div>
                    </div>
                    <div id="view-settings" class="tab-view hidden">
                        <div id="settings-grid"
                            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
                    </div>
                    <div id="view-export" class="tab-view hidden">
                        <div
                            class="bg-white p-10 rounded-3xl border border-slate-200 shadow-sm max-w-3xl mx-auto text-center">
                            <div
                                class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i data-lucide="file-spreadsheet" class="w-8 h-8"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-slate-900 mb-2">Export Database</h3>
                            <p class="text-slate-500 mb-8">Select fields to generate a CSV report.</p>
                            <form onsubmit="handleExport(event)">
                                <div
                                    class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-left bg-slate-50 p-6 rounded-2xl border border-slate-100">
                                    <label class="chk-label"><input type="checkbox" name="xc" value="ProspectName"
                                            checked> Name</label>
                                    <label class="chk-label"><input type="checkbox" name="xc" value="Phone" checked>
                                        Phone</label>
                                    <label class="chk-label"><input type="checkbox" name="xc" value="Route" checked>
                                        Route</label>
                                    <label class="chk-label"><input type="checkbox" name="xc" value="Status" checked>
                                        Status</label>
                                    <label class="chk-label"><input type="checkbox" name="export_col" value="Timestamp">
                                        Date</label>
                                    <label class="chk-label"><input type="checkbox" name="export_col" value="EnteredBy">
                                        User</label>
                                    <label class="chk-label"><input type="checkbox" name="export_col" value="TeamID">
                                        Team</label>
                                    <label class="chk-label"><input type="checkbox" name="export_col" value="Latitude">
                                        GPS</label>
                                </div>
                                <button type="submit" id="btn-export"
                                    class="w-full py-4 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold shadow-xl shadow-green-500/20 transition flex items-center justify-center gap-2"><i
                                        data-lucide="download" class="w-5 h-5"></i> Download CSV</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- MOBILE BOTTOM NAV (Starts Hidden) -->
        <div id="nav-mobile-bottom"
            class="hidden md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 h-20 z-50 flex justify-around items-start pt-3 pb-safe shadow-[0_-4px_20px_-4px_rgba(0,0,0,0.1)]">
            <!-- Injected by script.js -->
        </div>

    </div>

    <!-- ========================= MODALS ========================= -->

    <!-- INSTALL MODAL -->
    <div id="modal-install"
        class="hidden fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full text-center">
            <h3 class="font-bold text-xl mb-2">Install App</h3>
            <p class="text-slate-500 mb-6">Add to home screen for offline access.</p><button
                onclick="document.getElementById('modal-install').classList.add('hidden')"
                class="w-full py-3 bg-slate-900 text-white rounded-xl font-bold">Got it</button>
        </div>
    </div>

    <!-- STUDENT LEAD MODAL (Full fidelity) -->
    <div id="modal-student"
        class="fixed inset-0 bg-slate-900/50 z-[70] hidden flex items-end md:items-center justify-center p-4 backdrop-blur-sm">
        <div
            class="bg-white w-full max-w-lg rounded-t-3xl md:rounded-3xl p-6 max-h-[90vh] overflow-y-auto shadow-2xl animate-in slide-in-from-bottom-10">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-xl text-slate-800 flex items-center gap-2"><i data-lucide="graduation-cap"
                        class="w-6 h-6 text-brand-600"></i> New Student</h3><button
                    onclick="document.getElementById('modal-student').classList.add('hidden')"
                    class="p-2 bg-slate-100 rounded-full hover:bg-slate-200"><i data-lucide="x"
                        class="w-5 h-5 text-slate-600"></i></button>
            </div>
            <form onsubmit="handleSaveStudent(event)" class="space-y-5"><input type="hidden" name="Latitude"
                    id="st-lat"><input type="hidden" name="Longitude" id="st-lng">
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Source</label><select
                            name="DataSource" id="st-source" class="input-std"></select></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Category</label><select
                            name="Category" id="st-cat" class="input-std"></select></div>
                </div>
                <div><label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Full Name</label><input
                        name="Name" placeholder="Student Name" class="input-std" required></div>
                <div><label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Father Name</label><input
                        name="FatherName" placeholder="Father Name" class="input-std"></div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-xs font-bold text-slate-500 uppercase mb-1 block">DOB</label><input
                            name="DOB" type="date" class="input-std"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Phone</label><input
                            name="Phone" type="tel" pattern="[0-9]{10}" class="input-std" required></div>
                </div>
                <div><label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Address</label><input
                        name="Address" placeholder="Full Address" class="input-std"></div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Class</label><select
                            name="Class" id="st-class" class="input-std"></select></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Stream</label><select
                            name="Specialization" id="st-spec" class="input-std"></select></div>
                </div>
                <div><label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Interested In</label><select
                        name="InterestedCourse" id="st-course" class="input-std"></select></div>
                <div><label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Remarks</label><textarea
                        name="Notes" placeholder="Notes..." class="input-std h-20"></textarea></div>
                <div class="flex justify-between items-center bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <div class="flex items-center gap-2 font-bold text-blue-800 text-sm"><i data-lucide="map-pin"
                            class="w-4 h-4"></i> Location</div><button type="button"
                        onclick="captureLocation('st-lat','st-lng','st-gps-txt')" id="st-gps-txt"
                        class="bg-white border border-blue-200 text-blue-600 px-4 py-1.5 rounded-lg text-xs font-bold shadow-sm">Capture</button>
                </div><button id="btn-save-student"
                    class="w-full py-4 bg-brand-600 text-white rounded-xl font-bold text-lg shadow-xl shadow-brand-500/20 hover:bg-brand-700 transition">Save
                    Lead</button>
            </form>
        </div>
    </div>

    <!-- OTHER LEAD MODAL (High Fidelity) -->
    <div id="modal-other"
        class="fixed inset-0 bg-slate-900/50 z-[70] hidden flex items-end md:items-center justify-center p-4 backdrop-blur-sm">
        <div
            class="bg-white w-full max-w-lg rounded-t-3xl md:rounded-3xl p-6 max-h-[90vh] overflow-y-auto shadow-2xl animate-in slide-in-from-bottom-10">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-xl text-slate-800 flex items-center gap-2"><i data-lucide="building-2"
                        class="w-6 h-6 text-slate-600"></i> Other Lead</h3><button
                    onclick="document.getElementById('modal-other').classList.add('hidden')"
                    class="p-2 bg-slate-100 rounded-full hover:bg-slate-200"><i data-lucide="x"
                        class="w-5 h-5 text-slate-600"></i></button>
            </div>
            <div class="flex bg-slate-100 p-1.5 rounded-xl mb-6"><button type="button"
                    onclick="toggleOtherMode('Route')" id="btn-mode-Route"
                    class="mode-btn flex-1 py-2.5 rounded-lg text-sm font-bold bg-white shadow text-slate-800 transition-all">By
                    Route</button><button type="button" onclick="toggleOtherMode('Name')" id="btn-mode-Name"
                    class="mode-btn flex-1 py-2.5 rounded-lg text-sm font-bold text-slate-500 hover:text-slate-700 transition-all">By
                    Name</button></div>
            <form onsubmit="handleSaveOther(event)" class="space-y-5"><input type="hidden" id="other-mode"
                    value="Route"><input type="hidden" name="Latitude" id="ot-lat"><input type="hidden" name="Longitude"
                    id="ot-lng">
                <div id="sec-route">
                    <div class="space-y-4 border-b pb-6 mb-6 bg-slate-50/50 p-4 rounded-2xl border border-slate-100">
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Route
                            Details</label><select name="Route" id="ot-route" class="input-std bg-white"></select><input
                            name="VillageCity" placeholder="Village Name" class="input-std bg-white">
                        <div class="grid grid-cols-2 gap-3"><input name="SarpanchName" placeholder="Sarpanch"
                                class="input-std bg-white"><input name="SarpanchContact" placeholder="Contact"
                                class="input-std bg-white"></div>
                    </div>
                    <div class="border-2 border-dashed border-brand-200 p-5 rounded-2xl bg-brand-50/30">
                        <h4 class="text-sm font-bold text-brand-800 mb-4 flex items-center gap-2"><i
                                data-lucide="plus-circle" class="w-4 h-4"></i> Add Institute</h4><input
                            id="other-school-name" placeholder="Institute Name" class="input-std mb-3 bg-white">
                        <div class="grid grid-cols-2 gap-3 mb-3"><input id="other-school-prospect"
                                placeholder="Prospect Name" class="input-std bg-white"><input id="other-school-contact"
                                placeholder="Contact No" class="input-std bg-white"></div><input
                            id="other-school-remark" placeholder="Remark" class="input-std mb-4 bg-white"><button
                            type="button" onclick="addSchoolToBuffer()"
                            class="w-full py-2.5 bg-brand-600 text-white rounded-xl text-sm font-bold hover:bg-brand-700 shadow-md shadow-brand-500/20 transition">+
                            Add to List</button>
                    </div>
                    <div id="school-buffer-list" class="mt-4 space-y-2"></div>
                </div>
                <div id="sec-direct" class="hidden space-y-4"><input name="DirectName" placeholder="Institute Name"
                        class="input-std">
                    <div class="grid grid-cols-2 gap-3"><input name="DirectProspect" placeholder="Prospect Name"
                            class="input-std"><input name="DirectContact" placeholder="Contact No" class="input-std">
                    </div><textarea name="DirectRemark" placeholder="Remark..." class="input-std h-24"></textarea>
                </div>
                <div class="flex justify-between items-center bg-slate-50 p-4 rounded-xl border border-slate-200 mt-4">
                    <div class="flex items-center gap-2 font-bold text-slate-700 text-sm"><i data-lucide="map-pin"
                            class="w-4 h-4"></i> GPS Location</div><button type="button"
                        onclick="captureLocation('ot-lat','ot-lng','ot-gps-txt')" id="ot-gps-txt"
                        class="bg-white border border-slate-300 text-slate-700 px-4 py-1.5 rounded-lg text-xs font-bold shadow-sm">Capture</button>
                </div><button id="btn-save-other"
                    class="w-full py-4 bg-slate-800 text-white rounded-xl font-bold mt-4 shadow-lg hover:bg-slate-900 transition">Save
                    All</button>
            </form>
        </div>
    </div>

    <!-- EDIT LEAD MODAL -->
    <div id="modal-edit-lead"
        class="fixed inset-0 bg-black/60 z-[80] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-3xl p-8 shadow-2xl animate-in zoom-in duration-200">
            <h3 class="font-bold text-xl mb-6 text-slate-800">Update Status</h3>
            <form id="form-edit-lead" onsubmit="handleUpdateLead(event)" class="space-y-5"><input type="hidden"
                    name="LeadID">
                <div><label class="text-xs font-bold text-slate-500 uppercase mb-2 block">Status</label><select
                        name="Status" class="input-std h-12">
                        <option value="New">New</option>
                        <option value="Interested">Interested</option>
                        <option value="Converted">Converted</option>
                        <option value="Not Interested">Not Interested</option>
                    </select></div>
                <div><label class="text-xs font-bold text-slate-500 uppercase mb-2 block">Note</label><textarea
                        name="Notes" class="input-std h-32"></textarea></div>
                <div class="flex gap-3 pt-2"><button type="button"
                        onclick="document.getElementById('modal-edit-lead').classList.add('hidden')"
                        class="flex-1 py-3 text-slate-600 font-bold bg-slate-100 rounded-xl hover:bg-slate-200">Cancel</button><button
                        type="submit" id="btn-update-lead"
                        class="flex-1 py-3 bg-brand-600 text-white rounded-xl font-bold hover:bg-brand-700 shadow-lg">Update</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ADMIN MODALS (User & Team) - Hidden by default -->
    <div id="modal-user" class="fixed inset-0 bg-black/50 z-[80] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-2xl p-6">
            <div class="flex justify-between mb-6">
                <h3 class="font-bold text-xl">User Details</h3><button
                    onclick="document.getElementById('modal-user').classList.add('hidden')">✕</button>
            </div>
            <form id="form-user" onsubmit="handleSaveUser(event)" class="space-y-4"><input type="hidden"
                    name="UserID"><input name="Name" placeholder="Full Name" class="input-std" required><input
                    name="Email" placeholder="Email" class="input-std" required><input name="Phone" placeholder="Phone"
                    class="input-std" required>
                <div class="grid grid-cols-2 gap-3"><select name="Role" class="input-std"
                        onchange="handleRoleChange(this.value)">
                        <option value="user">Executive</option>
                        <option value="supervisor">Supervisor</option>
                        <option value="admin">Admin</option>
                    </select>
                    <div id="u-team-div"><select name="TeamID" id="in-user-team" class="input-std"></select></div>
                </div>
                <div id="user-password-group"><input name="Password" id="in-user-password" type="text"
                        placeholder="Set Password" class="input-std"></div><button type="button" id="btn-reset-pwd"
                    onclick="showPasswordReset()" class="hidden text-xs text-brand-600 font-bold hover:underline">Reset
                    Password</button><button type="submit" id="btn-save-user"
                    class="w-full py-3 bg-brand-600 text-white rounded-xl font-bold mt-2">Save User</button>
            </form>
        </div>
    </div>
    <div id="modal-team" class="fixed inset-0 bg-black/50 z-[80] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-2xl p-6">
            <h3 class="font-bold text-xl mb-6">Create Team</h3>
            <form onsubmit="handleAddTeam(event)" class="space-y-4"><input name="Name" placeholder="Team Name"
                    class="input-std" required><select name="SupervisorID" id="in-team-sup" class="input-std"
                    required></select><button type="submit" id="btn-save-team"
                    class="w-full py-3 bg-slate-900 text-white rounded-xl font-bold mt-2">Create Team</button></form>
        </div>
    </div>

</body>

</html>